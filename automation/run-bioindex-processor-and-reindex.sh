#!/bin/bash

set -u
set -e 
set -x

ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage GenesStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index genes -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage GeneVariantsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-variants -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage GeneLinksStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-links -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage VariantsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index variant -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage AnnotatedRegionsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index annotated-regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index tissue-regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage GlobalEnrichmentStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index global-enrichment -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage TranscriptionsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index transcript-consequences -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index transcription-factors -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage CredibleSetsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index credible-regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index credible-sets -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index credible-variants -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage ClumpedVariantsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index clumped-matrix -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index clumped-variants -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage AssociationsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage TopAssociationsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index top-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index global-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage PhewasAssociationsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index phewas-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage DatasetAssociationsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index dataset-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage VariantAssociationsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index variant-dataset-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage GeneAssociationsStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-associations-52k -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-finder -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --stage BurdenStage --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index burden -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
