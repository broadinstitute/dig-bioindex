#!/bin/bash

set -u
set -e 
set -x

PHENOS="2hrGadjBMI,FGadjBMI,FIadjBMI,HBA1CadjBMI"

ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage GenesStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index genes -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage GeneVariantsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-variants -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage GeneLinksStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-links -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage VariantsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index variant -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage AnnotatedRegionsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index annotated-regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index tissue-regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage GlobalEnrichmentStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index global-enrichment -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage TranscriptionsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index transcript-consequences -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index transcription-factors -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage CredibleSetsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index credible-regions -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index credible-sets -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index credible-variants -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage ClumpedVariantsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index clumped-matrix -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index clumped-variants -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage AssociationsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage TopAssociationsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index top-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index global-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage PhewasAssociationsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index phewas-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage DatasetAssociationsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index dataset-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage VariantAssociationsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index variant-dataset-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage GeneAssociationsStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-associations -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-associations-52k -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index gene-finder -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh aggregator "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/dig-aggregator-methods && ./run.sh bioindex --non-interactive --reprocess --stage BurdenStage --only ${PHENOS} --clusters 20 --yes) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh aggregator "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
ssh bioindex "screen -DmS automation bash -xeu -c '(cd /home/ec2-user/bioindex && yes | python3 -m bioindex.main index burden -l -w 30) 2>&1 | tee /home/ec2-user/automation/log ; echo \${PIPESTATUS[0]} > /home/ec2-user/automation/exit-code '" && (EC="`ssh bioindex "cat /home/ec2-user/automation/exit-code"`" ; if [ "${EC}" -ne "0" ]; then exit ${EC}; fi) 
